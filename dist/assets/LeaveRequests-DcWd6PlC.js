const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-OiwZ0o1a.js","assets/index-CfPzR3wC.js","assets/vendor--Eh9ivFN.js","assets/genai-IPx1z701.js"])))=>i.map(i=>d[i]);
import{Q as n,r as o,W as h,M as V,j as e,C as A,a as $,T as G,a1 as H,L as r,$ as I,v as U,X as Y,p as W,b as B,N as w,_ as K}from"./index-CfPzR3wC.js";import{a as Q,b as X,c as Z}from"./colorUtils-iuXnZW-F.js";import{C as q}from"./check-6aO9XKTL.js";import"./vendor--Eh9ivFN.js";import"./genai-IPx1z701.js";const R=l=>l<0?0:l,ee=(l,u)=>{switch(u){case n.LEGAL_HOLIDAY:return R(l.totalVacationDays-l.usedVacationDays);case n.ADMINISTRATIVE:return R(l.totalAdminDays-l.usedAdminDays);case n.SICK_LEAVE:return R(l.totalSickLeaveDays-l.usedSickLeaveDays);default:return null}},te=(l,u,d)=>{if(!Number.isFinite(d)||d<=0)return{valid:!1,remainingDays:null,message:"La cantidad de días debe ser mayor que cero."};const c=ee(l,u);return c===null?{valid:!0,remainingDays:null}:d>c?{valid:!1,remainingDays:c,message:`Saldo insuficiente. Disponible: ${c} día(s). Solicitado: ${d} día(s).`}:{valid:!0,remainingDays:c}},T=15,oe=({requests:l,employees:u,updateRequestStatus:d,addNewRequest:c,onError:g})=>{const[P,S]=o.useState(!1),[p,z]=o.useState("all"),[b,O]=o.useState("all"),[x,f]=o.useState(1),[i,m]=o.useState({employeeId:"",type:n.LEGAL_HOLIDAY,shift:h.JC,startDate:"",endDate:"",reason:""}),v=o.useMemo(()=>V(i.startDate,i.endDate,i.type,i.shift),[i.startDate,i.endDate,i.type,i.shift]),E=t=>u.find(s=>s.id===t),j=o.useMemo(()=>{let t=l;return p!=="all"&&(t=t.filter(s=>s.status===p)),b!=="all"&&(t=t.filter(s=>s.type===b)),t},[l,p,b]),N=Math.max(1,Math.ceil(j.length/T)),L=o.useMemo(()=>{const t=(x-1)*T;return j.slice(t,t+T)},[j,x]),k=t=>{z(t),f(1)},M=t=>{O(t),f(1)},_=t=>{if(t.preventDefault(),!i.employeeId||!i.startDate||!i.endDate)return;const s=w(i.startDate),D=w(i.endDate);if(D<s){g("La fecha de término no puede ser anterior a la fecha de inicio.");return}if(l.some(C=>C.employeeId===i.employeeId&&C.status===r.APPROVED&&w(C.startDate)<=D&&w(C.endDate)>=s)){g("El funcionario ya tiene una solicitud aprobada en este rango de fechas.");return}if(v===0&&(i.type===n.LEGAL_HOLIDAY||i.type===n.ADMINISTRATIVE)){g("El rango seleccionado no contiene días hábiles.");return}const y=E(i.employeeId);if(!y){g("El funcionario seleccionado no existe. Refresca la vista e intenta nuevamente.");return}const F=te(y,i.type,v);if(!F.valid){g(F.message||"No hay saldo suficiente para esta solicitud.");return}c({employeeId:i.employeeId,type:i.type,shift:i.shift,startDate:i.startDate,endDate:i.endDate,daysCount:v,reason:i.reason}),S(!1),m({employeeId:"",type:n.LEGAL_HOLIDAY,shift:h.JC,startDate:"",endDate:"",reason:""})},J=async t=>{const s=E(t.employeeId);if(!s)return;const{jsPDF:D}=await K(async()=>{const{jsPDF:y}=await import("./jspdf.es.min-OiwZ0o1a.js").then(F=>F.j);return{jsPDF:y}},__vite__mapDeps([0,1,2,3])),a=new D;a.setFontSize(18),a.setFont("helvetica","bold"),a.text("RESOLUCIÓN DE FERIADO/PERMISO",105,20,{align:"center"}),a.setFontSize(10),a.setFont("helvetica","normal"),a.text(`N° Solicitud: ${t.id}`,20,30),a.text(`Fecha Emisión: ${new Date().toLocaleDateString("es-CL")}`,20,35),a.setLineWidth(.5),a.line(20,40,190,40),a.setFontSize(12),a.setFont("helvetica","bold"),a.text("I. DATOS DEL FUNCIONARIO",20,50),a.setFontSize(11),a.setFont("helvetica","normal"),a.text(`Nombre: ${s.firstName} ${s.lastName}`,30,60),a.text(`Cargo: ${s.position}`,30,67),a.text(`Departamento: ${s.department}`,30,74),a.text(`Email: ${s.email}`,30,81),a.setFontSize(12),a.setFont("helvetica","bold"),a.text("II. DETALLE DE LA SOLICITUD",20,100),a.setFontSize(11),a.setFont("helvetica","normal"),a.text(`Tipo de Permiso: ${t.type}`,30,110),a.text(`Jornada: ${t.shift||"Jornada Completa"}`,30,117),a.text(`Desde: ${I(t.startDate)}`,30,124),a.text(`Hasta: ${I(t.endDate)}`,100,124),a.text(`Días Totales Calculados: ${t.daysCount}`,30,131),t.reason&&a.text(`Motivo/Observación: ${t.reason}`,30,140,{maxWidth:160}),a.setFontSize(12),a.setFont("helvetica","bold"),a.text("III. RESOLUCIÓN",20,160),a.setFontSize(11),a.setFont("helvetica","normal"),a.text(`Estado: ${t.status.toUpperCase()}`,30,170),a.line(30,240,90,240),a.text("Firma Funcionario",45,245),a.line(120,240,180,240),a.text("Jefatura / RRHH",135,245),a.setFontSize(8),a.text("Documento generado automáticamente por Sistema de Gestión HR.",105,280,{align:"center"}),a.save(`Resolucion_${s.lastName}_${t.startDate}.pdf`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Solicitudes de Permiso"}),e.jsxs("button",{onClick:()=>S(!P),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 shadow-sm","aria-label":"Nueva solicitud de permiso",children:[e.jsx(A,{size:18,"aria-hidden":"true"}),"Nueva Solicitud"]})]}),P&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-indigo-100 animate-fade-in mb-6",role:"dialog","aria-label":"Formulario de nueva solicitud",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Ingresar Nueva Solicitud"}),e.jsxs("form",{onSubmit:_,className:"grid grid-cols-1 md:grid-cols-2 gap-4","aria-label":"Datos de la solicitud",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"req-employee",className:"block text-sm font-medium text-slate-700 mb-1",children:"Funcionario"}),e.jsxs("select",{id:"req-employee",className:"w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-indigo-500",value:i.employeeId,onChange:t=>m({...i,employeeId:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),u.map(t=>e.jsxs("option",{value:t.id,children:[t.firstName," ",t.lastName]},t.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"req-type",className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Permiso"}),e.jsx("select",{id:"req-type",className:"w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-indigo-500",value:i.type,onChange:t=>m({...i,type:t.target.value}),children:Object.values(n).map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"req-shift",className:"block text-sm font-medium text-slate-700 mb-1",children:"Jornada"}),e.jsxs("select",{id:"req-shift",className:"w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-indigo-500",value:i.shift,onChange:t=>m({...i,shift:t.target.value}),children:[e.jsx("option",{value:h.JC,children:"Completa (JC)"}),e.jsx("option",{value:h.JM,children:"Mañana (JM)"}),e.jsx("option",{value:h.JT,children:"Tarde (JT)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"req-start",className:"block text-sm font-medium text-slate-700 mb-1",children:"Desde"}),e.jsx("input",{id:"req-start",type:"date",className:"w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-indigo-500",value:i.startDate,onChange:t=>m({...i,startDate:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"req-end",className:"block text-sm font-medium text-slate-700 mb-1",children:"Hasta"}),e.jsx("input",{id:"req-end",type:"date",className:"w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-indigo-500",value:i.endDate,onChange:t=>m({...i,endDate:t.target.value}),required:!0})]}),e.jsxs("div",{className:"md:col-span-2 bg-indigo-50 border border-indigo-100 p-3 rounded-lg flex items-center justify-between","aria-live":"polite",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{size:18,className:"text-indigo-600","aria-hidden":"true"}),e.jsx("span",{className:"text-sm text-indigo-900 font-medium",children:"Días a descontar:"})]}),e.jsxs("span",{className:"text-lg font-bold text-indigo-700",children:[v," días"]})]}),(i.type===n.LEGAL_HOLIDAY||i.type===n.ADMINISTRATIVE)&&e.jsxs("div",{className:"md:col-span-2 flex items-start gap-2 text-xs text-slate-500",children:[e.jsx(G,{size:14,className:"mt-0.5 text-amber-500","aria-hidden":"true"}),e.jsx("p",{children:"El cálculo excluye fines de semana y feriados nacionales para Feriado Legal y Administrativo."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"req-reason",className:"block text-sm font-medium text-slate-700 mb-1",children:"Motivo"}),e.jsx("textarea",{id:"req-reason",className:"w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-indigo-500",rows:3,value:i.reason,onChange:t=>m({...i,reason:t.target.value})})]}),e.jsxs("div",{className:"md:col-span-2 flex justify-end gap-3 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>S(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-medium",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 shadow-md",children:"Guardar Solicitud"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 flex flex-wrap items-center justify-between gap-3 bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{size:16,className:"text-slate-400","aria-hidden":"true"}),e.jsx("label",{htmlFor:"filter-status",className:"text-sm font-medium text-slate-600",children:"Estado:"}),e.jsxs("select",{id:"filter-status",value:p,onChange:t=>k(t.target.value),className:"text-sm border border-slate-200 rounded-lg px-3 py-1.5 bg-white focus:ring-2 focus:ring-indigo-500 focus:outline-none",children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:r.PENDING,children:"Pendientes"}),e.jsx("option",{value:r.APPROVED,children:"Aprobadas"}),e.jsx("option",{value:r.REJECTED,children:"Rechazadas"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"filter-type",className:"text-sm font-medium text-slate-600",children:"Tipo:"}),e.jsxs("select",{id:"filter-type",value:b,onChange:t=>M(t.target.value),className:"text-sm border border-slate-200 rounded-lg px-3 py-1.5 bg-white focus:ring-2 focus:ring-indigo-500 focus:outline-none",children:[e.jsx("option",{value:"all",children:"Todos"}),Object.values(n).map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Mostrando ",L.length," de ",j.length," solicitudes"]})]}),e.jsx("div",{className:"divide-y divide-slate-100",children:L.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(A,{size:48,className:"mx-auto mb-3 opacity-20","aria-hidden":"true"}),e.jsx("p",{className:"font-medium text-slate-600",children:"No hay solicitudes que coincidan con los filtros."})]}):L.map(t=>{const s=E(t.employeeId);return e.jsxs("div",{className:"p-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0 ${Q(t.type)}`,"aria-hidden":"true",children:e.jsx(A,{size:20})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsxs("h4",{className:"font-semibold text-slate-900",children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]}),e.jsx("span",{className:X(t.shift||h.JC),children:t.shift||"JC"})]}),e.jsxs("p",{className:"text-sm text-slate-500",children:[t.type," • ",t.daysCount," días"]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1 flex items-center gap-1",children:[e.jsx($,{size:12,"aria-hidden":"true"}),I(t.startDate)," a ",I(t.endDate)]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-end sm:items-center gap-4 w-full sm:w-auto justify-between sm:justify-end",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide ${Z(t.status)}`,children:t.status}),e.jsxs("div",{className:"flex gap-2",children:[t.status===r.APPROVED&&e.jsx("button",{onClick:()=>{J(t)},className:"p-2 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-full transition-colors",title:"Descargar Resolución PDF","aria-label":`Descargar PDF de resolución para ${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}`,children:e.jsx(U,{size:18})}),t.status===r.PENDING&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(t.id,r.APPROVED),className:"p-2 bg-emerald-100 text-emerald-600 rounded-full hover:bg-emerald-200 transition-colors",title:"Aprobar","aria-label":`Aprobar solicitud de ${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}`,children:e.jsx(q,{size:18})}),e.jsx("button",{onClick:()=>d(t.id,r.REJECTED),className:"p-2 bg-rose-100 text-rose-600 rounded-full hover:bg-rose-200 transition-colors",title:"Rechazar","aria-label":`Rechazar solicitud de ${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}`,children:e.jsx(Y,{size:18})})]})]})]})]},t.id)})}),N>1&&e.jsxs("div",{className:"p-4 border-t border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("button",{onClick:()=>f(t=>Math.max(1,t-1)),disabled:x===1,className:"flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-slate-600 hover:text-indigo-600 disabled:opacity-40 disabled:cursor-not-allowed rounded-lg hover:bg-white transition-colors","aria-label":"Página anterior",children:[e.jsx(W,{size:16})," Anterior"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:N},(t,s)=>s+1).map(t=>e.jsx("button",{onClick:()=>f(t),className:`w-8 h-8 rounded-lg text-sm font-medium transition-colors ${x===t?"bg-indigo-600 text-white shadow-sm":"text-slate-600 hover:bg-white hover:text-indigo-600"}`,"aria-label":`Ir a página ${t}`,"aria-current":x===t?"page":void 0,children:t},t))}),e.jsxs("button",{onClick:()=>f(t=>Math.min(N,t+1)),disabled:x===N,className:"flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-slate-600 hover:text-indigo-600 disabled:opacity-40 disabled:cursor-not-allowed rounded-lg hover:bg-white transition-colors","aria-label":"Página siguiente",children:["Siguiente ",e.jsx(B,{size:16})]})]})]})]})};export{oe as LeaveRequests};
