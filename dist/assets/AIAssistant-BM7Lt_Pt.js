import{c as y,r as l,j as e,a2 as S,G as A,R as M}from"./index-CxovqTKt.js";import"./vendor--Eh9ivFN.js";import"./genai-IPx1z701.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],j=y("bot",R);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],$=y("send",k),w="".replace(/\/$/,""),E=r=>r.startsWith("/")?`${w}${r}`:`${w}/${r}`,D=async r=>{const o=await r.text();if(!o.trim())return null;try{return JSON.parse(o)}catch{return null}},T=15e3,L=async(r,o,p,n)=>{if(!n)return"Tu sesión expiró. Vuelve a iniciar sesión para usar el asistente IA.";const d=new AbortController,c=setTimeout(()=>d.abort(),T);try{const s=await fetch(E("/api/ai/ask"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},signal:d.signal,body:JSON.stringify({question:r,employees:o,requests:p})}),a=await D(s);return s.ok?(a==null?void 0:a.answer)||"Lo siento, no pude generar una respuesta en este momento.":s.status===401?"Tu sesión expiró. Vuelve a iniciar sesión para usar el asistente IA.":(a==null?void 0:a.error)||"Lo siento, no pude generar una respuesta en este momento."}catch(s){return s instanceof DOMException&&s.name==="AbortError"?"La consulta tardó demasiado. Intenta nuevamente con una pregunta más breve.":(console.error("AI assistant request error:",s),"Ocurrió un error al consultar al asistente inteligente. Por favor verifica tu conexión o intenta más tarde.")}finally{clearTimeout(c)}},f=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,P=({employees:r,requests:o,sessionToken:p})=>{const[n,d]=l.useState(""),[c,s]=l.useState(!1),[a,m]=l.useState([{id:"welcome",sender:"ai",text:"Hola. Soy tu asistente de RRHH. Puedo ayudarte con consultas sobre saldos de vacaciones, estado de solicitudes o reportes rápidos. ¿Qué necesitas saber hoy?",time:new Date}]),b=l.useRef(null),g=l.useRef(null),v=()=>{var t;(t=b.current)==null||t.scrollIntoView({behavior:"smooth"})};l.useEffect(()=>{v()},[a]);const N=async t=>{var u;if(t.preventDefault(),!n.trim())return;const x={id:f(),sender:"user",text:n,time:new Date};m(i=>[...i,x]),d(""),s(!0);try{const i=await L(x.text,r,o,p),h={id:f(),sender:"ai",text:i,time:new Date};m(I=>[...I,h])}catch{const i={id:f(),sender:"ai",text:"Lo siento, ocurrió un error al procesar tu consulta. Verifica tu conexión a internet y que la API backend esté en ejecución.",time:new Date};m(h=>[...h,i])}s(!1),(u=g.current)==null||u.focus()};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-2rem)] bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200",role:"region","aria-label":"Asistente Virtual de RRHH",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 p-6 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg","aria-hidden":"true",children:e.jsx(S,{className:"text-white",size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Asistente Virtual HR"}),e.jsx("p",{className:"text-indigo-100 text-sm",children:"Potenciado por Gemini"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 bg-slate-50",role:"log","aria-label":"Historial de conversación","aria-live":"polite",children:[a.map(t=>e.jsx("div",{className:`flex ${t.sender==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex gap-3 max-w-[80%] ${t.sender==="user"?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 mt-1
                 ${t.sender==="user"?"bg-indigo-600":"bg-purple-600"}`,"aria-hidden":"true",children:t.sender==="user"?e.jsx(A,{size:16,className:"text-white"}):e.jsx(j,{size:16,className:"text-white"})}),e.jsxs("div",{className:`p-4 rounded-2xl shadow-sm text-sm leading-relaxed
                 ${t.sender==="user"?"bg-indigo-600 text-white rounded-tr-none":"bg-white text-slate-700 rounded-tl-none border border-slate-100"}`,children:[t.text.split(`
`).map((x,u,i)=>e.jsxs(M.Fragment,{children:[x,u<i.length-1&&e.jsx("br",{})]},u)),e.jsx("p",{className:`text-[10px] mt-2 ${t.sender==="user"?"text-indigo-200":"text-slate-400"}`,children:t.time.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},t.id)),c&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"flex gap-3 max-w-[80%]",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center flex-shrink-0 mt-1","aria-hidden":"true",children:e.jsx(j,{size:16,className:"text-white"})}),e.jsx("div",{className:"p-4 rounded-2xl bg-white text-slate-700 rounded-tl-none border border-slate-100 shadow-sm",role:"status","aria-label":"Procesando respuesta",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce","aria-hidden":"true"}),e.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"},"aria-hidden":"true"}),e.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce",style:{animationDelay:"0.4s"},"aria-hidden":"true"})]})})]})}),e.jsx("div",{ref:b})]}),e.jsxs("div",{className:"p-4 bg-white border-t border-slate-100",children:[e.jsxs("form",{onSubmit:N,className:"relative","aria-label":"Enviar mensaje al asistente",children:[e.jsx("label",{htmlFor:"ai-input",className:"sr-only",children:"Escribe tu pregunta"}),e.jsx("input",{id:"ai-input",ref:g,type:"text",value:n,onChange:t=>d(t.target.value),placeholder:"Pregunta sobre funcionarios, permisos o saldos...",className:"w-full pl-6 pr-14 py-4 bg-slate-50 border border-slate-200 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-slate-700 shadow-inner",disabled:c,autoComplete:"off"}),e.jsx("button",{type:"submit",disabled:!n.trim()||c,className:"absolute right-2 top-2 p-2 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full text-white hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all","aria-label":"Enviar mensaje",children:e.jsx($,{size:20,"aria-hidden":"true"})})]}),e.jsx("p",{className:"text-center text-xs text-slate-400 mt-3",role:"note",children:"La IA puede cometer errores. Verifica la información importante."})]})]})};export{P as AIAssistant};
