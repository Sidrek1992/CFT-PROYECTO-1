import{c as w,Q as o,Z as L,W as D,r as u,L as C,N,$ as v,a0 as $,j as e,a1 as M,C as k}from"./index-DpkQ8c0_.js";import{g as O}from"./colorUtils-DQK6Ky97.js";import{C as R}from"./check-mtz_w6eY.js";import"./vendor--Eh9ivFN.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],V=w("copy",z);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],P=w("external-link",_);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],F=w("list-checks",H),G=(n,r,d)=>{let l=n||"- {NOMBRE}: {JORNADA} desde {DESDE} hasta {HASTA}.";return l=l.replace(/{NOMBRE}/g,`${r.firstName} ${r.lastName}`),l=l.replace(/{CARGO}/g,r.position),l=l.replace(/{TIPO}/g,d.type),l=l.replace(/{JORNADA}/g,L(d.shift||D.JC)),l=l.replace(/{DESDE}/g,d.startDate),l=l.replace(/{HASTA}/g,d.endDate),l=l.replace(/{MOTIVO}/g,d.reason||""),l},U=(n,r)=>{switch(n){case o.LEGAL_HOLIDAY:return r.templateLegalHoliday||r.emailTemplate;case o.ADMINISTRATIVE:return r.templateAdministrative||r.emailTemplate;case o.SICK_LEAVE:return r.templateSickLeave||r.emailTemplate;default:return r.emailTemplate}},K=(n,r,d,l)=>{let c=l;if(n.length===0)c+=`No hay funcionarios seleccionados o ausentes.
`;else{const f=[o.LEGAL_HOLIDAY,o.ADMINISTRATIVE,o.SICK_LEAVE,o.WITHOUT_PAY,o.PARENTAL];let y=!1;f.forEach(i=>{const b=n.filter(h=>h.type===i);b.length>0&&(y=!0,c+=`=== ${i.toUpperCase()} ===
`,b.forEach(h=>{const p=r.find(x=>x.id===h.employeeId);if(p){const x=U(h.type,d);c+=`${G(x,p,h)}
`}else c+=`- Desconocido: Hasta el ${h.endDate}
`}),c+=`
`)}),y||(c+=`No hay ausencias registradas en la selección.
`)}return c+=`Total reportados: ${n.length}

Saludos cordiales,
Unidad de Gestión de Personas`,c},Q=({employees:n,requests:r,config:d})=>{const[l,c]=u.useState(!1),[f,y]=u.useState("all"),[i,b]=u.useState(new Set),h=u.useMemo(()=>new Map(n.map(a=>[a.id,a])),[n]),p=u.useMemo(()=>{const a=new Date;return a.setHours(0,0,0,0),r.filter(s=>s.status===C.APPROVED).filter(s=>{const t=N(s.endDate);return t.setHours(23,59,59,999),t>=a}).sort((s,t)=>N(s.startDate).getTime()-N(t.startDate).getTime())},[r]),x=u.useMemo(()=>f==="all"?p:p.filter(a=>a.type===f),[p,f]);u.useEffect(()=>{const a=new Set(p.map(s=>s.id));b(s=>{const t=new Set(Array.from(s).filter(m=>a.has(m)));let g=t.size===s.size;if(g){for(const m of t)if(!s.has(m)){g=!1;break}}return g?s:t})},[p]);const S=a=>{b(s=>{const t=new Set(s);return t.has(a)?t.delete(a):t.add(a),t})},A=()=>{const a=x.map(s=>s.id);b(s=>{const t=new Set(s);return a.every(m=>t.has(m))?a.forEach(m=>t.delete(m)):a.forEach(m=>t.add(m)),t})},j=u.useMemo(()=>{const a=v($(),"long"),s=p.filter(g=>i.has(g.id));if(s.length===0)return`Estimados,

Se informa el detalle de funcionarios ausentes o con permisos programados al ${a}:

(Seleccione funcionarios de la lista para generar el reporte).

Saludos cordiales,
Unidad de Gestión de Personas`;const t=`Estimados,

Se informa el detalle de funcionarios ausentes o con permisos programados al ${a}, desglosado por tipo de ausencia:

`;return K(s,n,d,t)},[p,i,n,d]),E=`Reporte de Ausencias y Permisos - ${new Date().toLocaleDateString("es-CL")}`,T=()=>{navigator.clipboard.writeText(j),c(!0),setTimeout(()=>c(!1),2e3)},I=()=>{const a=`mailto:${d.notificationEmail}?subject=${encodeURIComponent(E)}&body=${encodeURIComponent(j)}`;window.open(a,"_blank")};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 animate-reveal",style:{animationDelay:"20ms"},children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Generador de Reportes"}),e.jsx("p",{className:"text-slate-500",children:"Seleccione los funcionarios para generar un informe categorizado por tipo de ausencia para toda la institución."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden flex flex-col h-[600px] animate-reveal",style:{animationDelay:"120ms"},role:"region","aria-label":"Lista de ausencias disponibles",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 bg-slate-50/50 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(M,{size:18,className:"text-indigo-600","aria-hidden":"true"}),"Ausencias Disponibles"]}),e.jsxs("div",{className:"text-xs text-slate-500","aria-live":"polite",children:[i.size," seleccionados"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("label",{htmlFor:"report-filter",className:"sr-only",children:"Filtrar por categoría"}),e.jsxs("select",{id:"report-filter",value:f,onChange:a=>y(a.target.value),className:"flex-1 text-sm border border-slate-200 rounded-lg px-3 py-2 bg-white focus:ring-2 focus:ring-indigo-500 focus:outline-none",children:[e.jsx("option",{value:"all",children:"Todas las Categorías"}),e.jsx("option",{value:o.LEGAL_HOLIDAY,children:"Solo Feriados Legales"}),e.jsx("option",{value:o.ADMINISTRATIVE,children:"Solo Administrativos"}),e.jsx("option",{value:o.SICK_LEAVE,children:"Solo Licencias Médicas"}),e.jsx("option",{value:o.WITHOUT_PAY,children:"Sin Goce de Sueldo"}),e.jsx("option",{value:o.PARENTAL,children:"Post Natal Parental"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:x.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400 p-6 text-center",children:[e.jsx(k,{size:48,className:"mb-2 opacity-20","aria-hidden":"true"}),e.jsx("p",{children:"No hay ausencias aprobadas para este filtro."})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 hover:bg-slate-50 rounded-lg cursor-pointer border-b border-slate-50 mb-2 sticky top-0 bg-white z-10 shadow-sm",onClick:A,role:"button",tabIndex:0,onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),A())},"aria-label":x.every(a=>i.has(a.id))?"Deseleccionar todos los visibles":"Seleccionar todos los visibles",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500",checked:x.length>0&&x.every(a=>i.has(a.id)),readOnly:!0,"aria-hidden":"true",tabIndex:-1}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:"Seleccionar Visibles"})]}),x.map(a=>{const s=h.get(a.employeeId);return e.jsxs("div",{onClick:()=>S(a.id),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),S(a.id))},className:`flex items-start gap-3 p-3 rounded-lg cursor-pointer transition-colors border border-transparent ${i.has(a.id)?"bg-indigo-50 border-indigo-100":"hover:bg-slate-50"}`,role:"checkbox",tabIndex:0,"aria-checked":i.has(a.id),"aria-label":`${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName} - ${a.type}`,children:[e.jsx("input",{type:"checkbox",className:"mt-1 w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500",checked:i.has(a.id),readOnly:!0,"aria-hidden":"true",tabIndex:-1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("p",{className:"text-sm font-medium text-slate-900 truncate",children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full font-medium ml-2 whitespace-nowrap border ${O(a.type)}`,children:a.type})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-0.5",children:[e.jsx("p",{className:"text-xs text-slate-500",children:s==null?void 0:s.position}),a.shift&&a.shift!==D.JC&&e.jsx("span",{className:"text-[10px] px-1 py-0 bg-amber-50 text-amber-600 border border-amber-100 rounded",children:a.shift})]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1 flex items-center gap-1",children:[e.jsx(k,{size:10,"aria-hidden":"true"}),v(a.startDate)," ",e.jsx("span",{className:"text-slate-300",children:"➜"})," ",v(a.endDate)]})]})]},a.id)})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden flex flex-col h-[600px] animate-reveal",style:{animationDelay:"220ms"},role:"region","aria-label":"Vista previa del reporte",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(F,{size:18,className:"text-indigo-600","aria-hidden":"true"}),"Vista Previa del Reporte"]}),e.jsxs("div",{className:"text-xs text-slate-500 bg-white px-2 py-1 rounded border border-slate-200",children:["Para: ",e.jsx("span",{className:"font-medium text-slate-700",children:d.notificationEmail})]})]}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("label",{htmlFor:"report-subject",className:"text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Asunto"}),e.jsx("div",{id:"report-subject",className:"p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-slate-800 text-sm font-medium truncate",children:E})]}),e.jsxs("div",{className:"space-y-2 flex-1 flex flex-col min-h-0",children:[e.jsx("label",{htmlFor:"report-body",className:"text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Cuerpo del Mensaje (Agrupado por Tipo)"}),e.jsx("textarea",{id:"report-body",readOnly:!0,value:j,className:"w-full flex-1 p-4 bg-slate-50 border border-slate-200 rounded-lg text-slate-700 font-mono text-sm focus:outline-none resize-none leading-relaxed","aria-label":"Vista previa del cuerpo del reporte"})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-2 mb-4 text-right",children:"El sistema usa la plantilla configurada para cada tipo de ausencia."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:I,disabled:i.size===0,className:"flex-1 flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white px-4 py-2.5 rounded-lg font-medium transition-all shadow-sm hover:shadow-md","aria-label":`Enviar reporte con ${i.size} funcionarios seleccionados`,children:[e.jsx(P,{size:18,"aria-hidden":"true"}),"Enviar Reporte"]}),e.jsxs("button",{onClick:T,disabled:i.size===0,className:`flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all border ${l?"bg-emerald-50 border-emerald-200 text-emerald-700":"bg-white border-slate-200 text-slate-700 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed"}`,"aria-label":"Copiar reporte al portapapeles",children:[l?e.jsx(R,{size:18}):e.jsx(V,{size:18}),l?"Copiado":"Copiar"]})]})]})]})]})]})};export{Q as Reports};
